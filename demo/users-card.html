<!doctype html>
<html>
	<head>
		<title></title>
		<script src="../../webcomponentsjs/webcomponents-lite.js"></script>
		<link rel="import" href="../../polymer/polymer.html">
		<link rel="import" href="../paper-datatable-card.html">
		<link rel="import" href="../paper-datatable.html">
	</head>
	<body>

		<div style="text-align:center; margin: 10px;">
			<a href="index.html">See all other demo's</a>
		</div>

		<template is="dom-bind" id="app">

			<paper-datatable-card id="datatableCard" header="Users" page-size="10" data-source="{{dataSource}}" progress>
				<div toolbar-main>
				</div>
				<div toolbar-select>
					<paper-icon-button icon="delete" on-tap="delete"></paper-icon-button>
				</div>
				<paper-datatable id="datatable" id-property="sha1" selectable>
					<paper-datatable-column id="nameColumn" header="Name" property="name" capitalize="[[capitalize]]" style="min-width: 300px">
						<template>
							<div>
								<img src="[[item.picture.thumbnail]]" style="width:32px;height:32px;border-radius:16px;vertical-align: middle;">
								<span>[[capitalize(value.title)]]</span>
								<span>[[capitalize(value.first)]]</span>
								<span>[[capitalize(value.last)]]</span>
							</div>
						</template>
					</paper-datatable-column>
					<paper-datatable-column header="E-mail" property="email"></paper-datatable-column>
					<paper-datatable-column header="SSN" property="SSN"></paper-datatable-column>
					<paper-datatable-column header="Phone" property="phone"></paper-datatable-column>
					<paper-datatable-column header="Cell" property="cell"></paper-datatable-column>
					<paper-datatable-column header="Address" property="location" capitalize="[[capitalize]]">
						<template>
							<div>[[capitalize(value.street)]]</div>
							<div><span>[[capitalize(value.state)]]</span> <span>[[capitalize(value.zip)]]</span></div>
						</template>
					</paper-datatable-column>
				</paper-datatable>
			</paper-datatable-card>

		</template>

		<script>
			var app = document.querySelector('#app');

			app.dataSource = {
				get: function(sort, page, pageSize){
					return new Promise(function(resolve, reject){
						var httpRequest = new XMLHttpRequest();
						httpRequest.onreadystatechange = function() {
							if (httpRequest.readyState === XMLHttpRequest.DONE) {
								if (httpRequest.status === 200) {
									var result = JSON.parse(httpRequest.responseText);
									var users = result.results.map(function(resultItem){
										return resultItem.user;
									});
									resolve(users);
								}
							}
						};
						httpRequest.open('GET', 'http://api.randomuser.me/?nat=US&results='+pageSize);
						httpRequest.send();
					});
				},
				set: function(id, property, value){
					console.info("a save was triggered");
					var item = myData.find(function(item){
						return item.id == id;
					});
					item[property] = value;
				},
				length:100
			};

			app.capitalize = function(str){
				return str.toString().split(' ').map(function(str){
					return str.substr(0,1).toUpperCase() + str.substr(1, str.length - 1);
				}).join(' ');
			};

			app.delete = function(){
				//do your delete first
				app.set('dataSource.length', app.dataSource.length - 1);
				// and then call:
				app.$.datatable.deselectAll();
				app.$.datatableCard.retrieveVisibleData();
			};

		</script>

	</body>
</html>